<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.shoppingmall.item.mapper.ItemMapper">


    <resultMap id="viewItemItemStock" type="com.example.shoppingmall.item.domain.ItemItemStock">
        <id column="item_no" property="itemNo"/>
        <result column="item_name" property="itemName"/>
        <result column="item_price" property="itemPrice"/>
        <result column="item_category" property="itemCategory"/>
        <result column="item_onsale" property="itemOnsale"/>
        <collection property="itemStockList" resultMap="itemStockResult">
            <id column="item_stock_no" property="itemStockNo"/>
            <result column="item_no" property="itemNo"/>
            <result column="item_size" property="itemSize"/>
            <result column="item_stock_value" property="itemStockValue"/>
        </collection>
    </resultMap>



    <select id="joinItemItemStock" resultMap="viewItemItemStock">
        select a.item_no,
               a.item_name,
               a.item_price,
               a.item_category,
               a.item_onsale,
               b.item_size,
               b.item_stock_value
        from item as a, item_stock as b
        where a.item_no = b.item_no
    </select>


    <insert id="saveItem" parameterType="com.example.shoppingmall.item.domain.Item">
        insert into item
        values (#{itemNo},#{itemName},#{itemCategory},#{itemGrade},#{itemDetail},#{itemPrice},1,DATE_ADD(NOW(), INTERVAL 0 HOUR))
    </insert>

    <select id="getMaxItemNo" resultType="Long">
        select max(item_no) from item
    </select>

    <insert id="saveItemPhotos" parameterType="com.example.shoppingmall.item.domain.ItemPhotos">
        insert into item_photos
        values (#{itemNo}, #{itemThumb}, #{itemImg1}, #{itemImg2}, #{itemImg3}, #{itemThumbModified}, #{itemImg1Modified}, #{itemImg2Modified}, #{itemImg3Modified})
    </insert>

    <insert id="saveItemStock" parameterType="com.example.shoppingmall.item.domain.ItemStock">
        insert into item_stock
        values (#{itemStockNo}, #{itemNo}, #{itemSize}, #{itemStockValue})
    </insert>

    <select id="findAllItems" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item order by item_no desc
    </select>

    <select id="findAllItemsBySearchKeyword" parameterType="com.example.shoppingmall.item.form.ItemCategoricalSearchPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') and item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="findAllItemsOuterBySearchKeyword" parameterType="com.example.shoppingmall.item.form.ItemCategoricalSearchPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') and item_category = 'outer' and item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="findAllItemsInnerBySearchKeyword" parameterType="com.example.shoppingmall.item.form.ItemCategoricalSearchPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') and item_category = 'inner' and item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="findAllItemsPantsBySearchKeyword" parameterType="com.example.shoppingmall.item.form.ItemCategoricalSearchPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') and item_category = 'pants' and item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="findAllItemsByCategory" parameterType="String" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_category = #{category} and item_onsale = 1 order by item_no desc
    </select>

    <select id="findAllItemStocks" parameterType="long" resultType="com.example.shoppingmall.item.domain.ItemStock">
        select * from item_stock where item_no = #{itemNo}
    </select>

    <select id="findAllItemsOnsale" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_onsale = 1 order by item_no desc
    </select>

    <select id="findAllItemsOffmarket" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_onsale = 0 order by item_no desc
    </select>

    <select id="findItemByNo" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_no = #{itemNo}
    </select>

    <select id="findItemsByName" parameterType="String" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') order by item_no desc
    </select>

    <update id="updateItemByNo" parameterType="com.example.shoppingmall.item.domain.Item">
        update item
        set item_name = #{itemName},
            item_category=#{itemCategory},
            item_detail=#{itemDetail},
        where item_no = #{itemNo}
    </update>

    <update id="updateItemStockByNo" parameterType="com.example.shoppingmall.item.domain.ItemStock">
        update item_stock
        set item_stock = #{itemStockValue}
        where item_stock_no=#{item_stock_no}
    </update>

    <select id="findItemStocksByItemNo" parameterType="com.example.shoppingmall.item.domain.Item" resultType="java.util.List">
        select * from item_stock where item_no = #{itemNo}
    </select>

    <delete id="deleteItemStockByItemNo" parameterType="long">
        delete from item_stock where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemPhotosByItemNo" parameterType="long">
        delete from item_photos where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemByItemNo" parameterType="long">
        delete from item where item_no = #{itemNo}
    </delete>

    <select id="findItemPhotosByItemNo" parameterType="long" resultType="com.example.shoppingmall.item.domain.ItemPhotos">
        select * from item_photos where item_no = #{itemNo}
    </select>

    <select id="selectItemThumbByItemNo" parameterType="long" resultType="com.example.shoppingmall.item.domain.ItemPhotos">
        select item_thumb from item_photos where item_no = #{itemNo}
    </select>

    <select id="findAllItemsByPaging" parameterType="java.util.HashMap" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="getItemListPageByCategory" parameterType="com.example.shoppingmall.item.form.ItemCategoryPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_category = #{category} and item_onsale = 1 order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="getItemListPageBySearch" parameterType="com.example.shoppingmall.item.form.ItemSearchForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') order by item_no desc limit #{startPage}, #{itemsPerPage}
    </select>

    <select id="findItemListPageBySearchAndCategory" parameterType="com.example.shoppingmall.item.form.ItemCategoricalSearchPageForm" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_name like concat('%', #{searchKeyword}, '%') and item_category = #{category} and item_onsale = 1 order by item_no desc
    </select>

    <select id="getItemStockValueByItemNoAndItemSize" parameterType="com.example.shoppingmall.item.dto.ItemStockDTO" resultType="Integer">
        select item_stock_value from item_stock where item_no = #{itemNo} and item_size = #{itemSize}
    </select>

    <select id="getItemThumbByNo" parameterType="Long" resultType="String">
        select item_thumb from item_photos where item_no = #{itemNo}
    </select>

</mapper>