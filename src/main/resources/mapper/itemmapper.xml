<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.shoppingmall.item.mapper.ItemMapper">


    <resultMap id="viewItemItemStock" type="com.example.shoppingmall.item.domain.ItemItemStock">
        <id column="item_no" property="itemNo"/>
        <result column="item_name" property="itemName"/>
        <result column="item_price" property="itemPrice"/>
        <result column="item_category" property="itemCategory"/>
        <result column="item_onsale" property="itemOnsale"/>
        <collection property="itemStockList" resultMap="itemStockResult">
            <id column="item_stock_no" property="itemStockNo"/>
            <result column="item_no" property="itemNo"/>
            <result column="item_size" property="itemSize"/>
            <result column="item_stock_value" property="itemStockValue"/>
        </collection>
    </resultMap>



    <select id="joinItemItemStock" resultMap="viewItemItemStock">
        select a.item_no,
               a.item_name,
               a.item_price,
               a.item_category,
               a.item_onsale,
               b.item_size,
               b.item_stock_value
        from item as a, item_stock as b
        where a.item_no = b.item_no
    </select>


    <insert id="saveItem" parameterType="com.example.shoppingmall.item.domain.Item">
        insert into item
        values (#{itemNo},#{itemName},#{itemCategory},#{itemGrade},#{itemDetail},#{itemPrice},#{itemOnsale},DATE_ADD(NOW(), INTERVAL 0 HOUR))
    </insert>

    <select id="getMaxItemNo" resultType="Long">
        select max(item_no) from item
    </select>

    <insert id="saveItemPhotos" parameterType="com.example.shoppingmall.item.domain.ItemPhotos">
        insert into item_photos
        values (#{itemNo}, #{itemThumb}, #{itemImg1}, #{itemImg2}, #{itemImg3}, #{itemThumbModified}, #{itemImg1Modified}, #{itemImg2Modified}, #{itemImg3Modified})
    </insert>

    <insert id="saveItemStock" parameterType="com.example.shoppingmall.item.domain.ItemStock">
        insert into item_stock
        values (#{itemStockNo}, #{itemNo}, #{itemSize}, #{itemStockValue})
    </insert>

    <select id="findAllItems" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item order by item_no desc
    </select>

    <select id="findAllItemStocks" parameterType="Long" resultType="com.example.shoppingmall.item.domain.ItemStock">
        select * from item_stock where item_no = #{itemNo}
    </select>

    <select id="findAllItemsOnsale" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_onsale = 1
    </select>

    <select id="findAllItemsOffmarket" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_onsale = 0
    </select>

    <select id="findItemByNo" resultType="com.example.shoppingmall.item.domain.Item">
        select * from item where item_no = #{itemNo}
    </select>

    <select id="findItemsByName" resultType="java.lang.String">
        select * from item where item_name = #{itemName}
    </select>

    <update id="updateItemByNo" parameterType="com.example.shoppingmall.item.domain.Item">
        update item
        set item_name = #{itemName},
            item_category=#{itemCategory},
            item_detail=#{itemDetail},
            item_onsale=#{itemOnsale}
        where item_no = #{itemNo}
    </update>

    <update id="updateItemStockByNo" parameterType="com.example.shoppingmall.item.domain.ItemStock">
        update item_stock
        set item_stock = #{itemStockValue}
        where item_stock_no=#{item_stock_no}
    </update>

    <delete id="deleteItemByNo" parameterType="com.example.shoppingmall.item.domain.Item">
        delete from item where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemPhotosByNo" parameterType="com.example.shoppingmall.item.domain.ItemPhotos">
        delete from item where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemStockByStockNo" parameterType="com.example.shoppingmall.item.domain.ItemStock">
        delete from item where item_stock_no = #{itemStockNo}
    </delete>

    <select id="findItemStocksByItemNo" parameterType="com.example.shoppingmall.item.domain.Item" resultType="java.util.List">
        select * from item_stock where item_no = #{itemNo}
    </select>

    <delete id="deleteItemStockByItemNo" parameterType="long">
        delete from item_stock where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemPhotosByItemNo" parameterType="long">
        delete from item_photos where item_no = #{itemNo}
    </delete>

    <delete id="deleteItemByItemNo" parameterType="long">
        delete from item where item_no = #{itemNo}
    </delete>

</mapper>